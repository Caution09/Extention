<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="popup.css" />
  </head>

  <body style="width: 540px">
    <h1>Prompt Generator</h1>
    <label for="displayType">表示タイプ:</label>
    <select id="displayType">
      <option value="normal">通常表示</option>
      <option value="popup">ポップアップ表示</option>
      <option value="page">ページ表示</option>
    </select>
    <div class="tab-panel">
      <ul class="tab-group">
        <li class="tab tab-A is-active">検索</li>
        <li class="tab tab-C" id="addTab">辞書</li>
        <li class="tab tab-B" id="editTab">編集</li>
        <li class="tab tab-E" id="slotTab">スロット</li>
        <li class="tab tab-D" id="noticeTab">その他</li>
      </ul>
      <select
        id="prompt-slot-selector"
        style="width: 150px; margin-right: 5px; font-size: 100%"
      >
        <option value="0">1</option>
      </select>

      <input type="button" id="copyButton" value="Copy" />
      <input type="button" id="clearButton" value="Clear" />
      <input type="button" id="saveButton" value="Save" />
      <label
        ><input type="radio" name="UIType" value="SD" /> StableDiffusion</label
      >
      <label><input type="radio" name="UIType" value="NAI" /> NovelAI</label>
      <label
        ><input type="radio" name="UIType" value="None" /> 自動整形無し</label
      >
      <br />
      <input
        type="text"
        id="generatePrompt"
        style="width: calc(100% - 110px)"
      />
      <input
        type="button"
        id="GeneratoButton"
        value="Generate"
        style="width: 100px; display: none"
      />
      <br />
      <!--タブを切り替えて表示するコンテンツ-->
      <div class="panel-group">
        <div class="panel is-show" id="searchTabBody">
          <h2>キーワード検索</h2>
          <input type="text" size="25" id="search" value="" />
          <input type="button" id="searchButton" value="検索" />
          <h2>ドロップダウン検索</h2>
          <ul style="font-size: 100%">
            <li>
              <input
                value="大項目"
                type="text"
                readonly=""
                class="promptData"
                style="background-color: black; color: white"
              /><input
                value="中項目"
                type="text"
                readonly=""
                class="promptData"
                style="background-color: black; color: white"
              /><input
                value="小項目"
                type="text"
                readonly=""
                class="promptData"
                style="background-color: black; color: white"
              />
            </li>
            <li>
              <div class="dropdown-container">
                <select id="search-cat0" disabled></select>
                <select id="search-cat1" disabled></select>
              </div>
              <input type="button" id="search-cat-reset" value="リセット" />
            </li>
          </ul>
          <hr />
          <p id="isSearch" style="font-size: 100%"></p>
          <ul style="font-size: 100%" id="promptList"></ul>
        </div>
        <div class="panel" id="addTabBody">
          <br />
          <div id="promptDicText">▶プロンプト辞書　※ここをクリックで開閉</div>
          <ul style="font-size: 100%" id="archiveList"></ul>
          <hr />
          <h2>要素の追加</h2>
          <ul style="font-size: 100%">
            <li>
              <input
                value="大項目"
                type="text"
                readonly=""
                class="promptData"
                style="background-color: black; color: white"
              /><input
                value="中項目"
                type="text"
                readonly=""
                class="promptData"
                style="background-color: black; color: white"
              /><input
                value="小項目"
                type="text"
                readonly=""
                class="promptData"
                style="background-color: black; color: white"
              /><input
                value="Prompt"
                type="text"
                readonly=""
                class="promptData"
                style="background-color: black; color: white"
              />
            </li>
            <li>
              <input type="text" size="2" id="big" class="promptData" /><input
                type="text"
                size="2"
                id="middle"
                class="promptData"
              /><input
                type="text"
                size="2"
                id="small"
                class="promptData"
              /><input
                type="text"
                size="2"
                id="prompt"
                class="promptData"
              /><input type="button" id="resist" value="追加" />
            </li>
          </ul>
          <div id="elementDicText">
            ▶要素辞書(ローカル)　※ここをクリックで開閉
          </div>
          <ul style="font-size: 100%" id="addPromptList"></ul>
          <div id="masterDicText">▶要素辞書(マスタ)　※ここをクリックで開閉</div>
          <ul style="font-size: 100%" id="masterDicList"></ul>
        </div>
        <div class="panel" id="editTabBody">
          <label
            ><input type="radio" name="EditType" value="SELECT" />
            選択編集モード</label
          >
          <label
            ><input type="radio" name="EditType" value="TEXT" />
            テキスト編集モード</label
          >
          <ul style="font-size: 100%" id="editList"></ul>
        </div>
        <div class="panel" id="slotTabBody">
          <h2>プロンプトスロット管理</h2>
          <div id="slot-info" style="margin-bottom: 10px">
            使用中: <span id="used-slots-count">0/0</span>
            <button id="combine-preview" style="float: right">
              結合プレビュー
            </button>
          </div>
        </div>
        <div class="panel" id="noticeBody">
          <div>
            <h3>お知らせ</h3>
            <p id="notice"></p>
          </div>
          <div></div>
            <h3>データ管理</h3>
            <div style="margin-top: 20px">
              <button id="clear-all-slots-tab">すべてクリア</button>
              <button id="export-slots">エクスポート</button>
              <button id="import-slots">インポート</button>
            </div>
            <div id="inclued" class="drop-area">
              <p id="incluedText">
                辞書（JSON）、画像（PNG）、CSVファイルを読み込む
                (クリックして選択かドラッグドロップ)
              </p>
            </div>
            <img id="preview" />
            <div id="pngInfo"></div>
          </div>
          <div id="slot-container">
            <!-- 動的に生成 -->
          </div>

          <hr style="margin: 20px 0" />

          <div id="autoGenerateOption" style="display: none">
            <h3>自動Generate設定（NovelAI専用）</h3>
            <label>
              <input type="checkbox" id="autoGenerate" />
              自動Generateを有効にする </label
            ><br />
            <label>
              生成回数:
              <input
                type="number"
                id="generateCount"
                value="10"
                min="0"
                max="1000"
                style="width: 60px"
              />
              <span style="font-size: 12px; color: #666"
                >（0で無限）</span
              > </label
            ><br />
            <label>
              生成間隔:
              <input
                type="number"
                id="generateInterval"
                value="5"
                min="3"
                max="60"
                style="width: 50px"
              />
              <span>秒</span> </label
            ><br />
            <br />
          </div>

          <!-- セレクター管理（既存のセレクター設定と統合） -->
          <div class="selector-management">
            <h3>セレクター設定</h3>
            <div class="selector-service">
              <label for="selector-service">対象サービス:</label>
              <select id="selector-service" style="width: 200px">
                <option value="">-- 選択してください --</option>
                <option value="novelai">NovelAI</option>
                <option value="stable_diffusion">Stable Diffusion WebUI</option>
                <option value="comfyui">ComfyUI</option>
                <option value="custom">カスタム</option>
              </select>
            </div>

            <div class="current-selectors" style="margin-top: 15px">
              <div class="selector-item">
                <label>プロンプト入力欄のセレクター:</label>
                <div class="selector-control">
                  <input
                    type="text"
                    id="positivePromptSelector"
                    placeholder="セレクターを入力..."
                    style="font-family: monospace"
                  />
                  <button
                    class="visual-select-btn"
                    data-target="positivePromptSelector"
                    title="ビジュアル選択"
                  >
                    🎯
                  </button>
                </div>
                <div class="selector-status" id="positivePromptStatus"></div>
              </div>

              <div class="selector-item" style="margin-top: 10px">
                <label>生成ボタンのセレクター:</label>
                <div class="selector-control">
                  <input
                    type="text"
                    id="generateButtonSelector"
                    placeholder="セレクターを入力..."
                    style="font-family: monospace"
                  />
                  <button
                    class="visual-select-btn"
                    data-target="generateButtonSelector"
                    title="ビジュアル選択"
                  >
                    🎯
                  </button>
                </div>
                <div class="selector-status" id="generateButtonStatus"></div>
              </div>
            </div>

            <div class="selector-actions" style="margin-top: 15px">
              <button id="saveSelectors">保存</button>
              <button id="clearSelectors">クリア</button>
            </div>

            <details style="margin-top: 15px">
              <summary style="cursor: pointer">セレクターの調べ方</summary>
              <div
                style="margin-top: 10px; padding-left: 20px; font-size: 12px"
              >
                <p>1. 対象ページで右クリック → 「検証」を選択</p>
                <p>2. 要素選択ツール（矢印アイコン）をクリック</p>
                <p>3. 目的の要素をクリック</p>
                <p>4. DevToolsで要素を右クリック → Copy → Copy selector</p>
                <p>または、「🎯」ボタンでビジュアル選択が可能です！</p>
              </div>
            </details>
          </div>

          <hr style="margin: 20px 0" />

          <!-- 元のoptionPanelの内容 -->
          <div class="settings-section">
            <h3>設定</h3>
            <label>
              <input type="checkbox" id="isDeleteCheck" value="isDeleteCheck" />
              項目の削除時に確認をする
            </label>
            <br />
            <label>
              DeepL APIキー<br />
              <input type="password" size="25" id="DeeplAuth" value="" />
            </label>
            <br />
            <label>
              <input
                type="checkbox"
                id="checkPromptConflict"
                value="checkPromptConflict"
              />
              プロンプトの重複時に警告をする
            </label>
            <br />
          </div>
        </div>
      </div>
    </div>
    <div id="popup" style="align-items: center">
      <img
        id="popup-image"
        src="assets/icon/Icon128.png"
        style="flex-grow: 1; padding: 10px"
      />
      <div style="flex-grow: 1; padding: 10px">
        <p>
          イメージとなります。数が膨大なため精査しておらず、正確なものでは有りません。
        </p>
        <p>画像をクリックして閉じることができます。</p>
        <p>Model Anytihng V3 Method DPM++ 2M scale 7</p>
        <p id="preview-element"></p>
        <p>Prompt</p>
        <input type="text" id="preview-prompt" value="" readonly />
        <button id="preview-positive-copy">Copy</button>
        <p>Negative Prompt</p>
        <input
          type="text"
          id="negative-prompt"
          value="disfigured.bad anatomy disfigured,jpeg artifacts,error,gross,shit,bad,bad proportions,bad shadow,bad anatomy disfigured,bad shoes,bad gloves,bad animal ears,anatomical nonsense,watermark,five fingers,worst quality,bad anatomy,ugly,cropped,simple background,normal quality,lowers,low quality,polar lowres,standard quality,poorly drawn hands,boken limb,missing limbs,malformed limbs,incorrect limb,fusion hand,bad finglegs,abnormal fingers,missing fingers,fewer digits,too many fingers,extra digit,lose finger,extra fingers,one hand with more than 5 digit,one hand with less than 5 digit,one hand with more than 5 fingers,one hand with less than 5 fingers,3d character,qr code,ui,artist name,signature,text error,text font ui,bar code,username,bad digit,liquid digit,missing digit,fewer digits,multiple digit,text,fused digit,extra digt,extra digits,extra digit,nsfw"
          readonly
        />
        <button id="preview-negative-copy">Copy</button>
      </div>
    </div>
    <button
      id="toggleManual"
      style="position: fixed; bottom: 10px; right: 10px"
    >
      一覧
    </button>
    <button id="show-shortcuts" style="position: fixed; top: 0; right: 0">
      ?
    </button>
    <datalist id="category"> </datalist>

    <!-- 外部ライブラリ -->
    <script src="lib/jquery-3.5.1.js"></script>
    <script src="lib/jquery-ui.js"></script>
    <script src="lib/papaparse.js"></script>
    <script src="lib/papaparse.min.js"></script>

    <!-- リソース -->
    <script src="assets/master/default-master.js"></script>

    <!-- コア機能 -->
    <script src="js/core/storage.js"></script>
    <script src="js/core/app-state.js"></script>
    <script src="js/core/error-handler.js"></script>
    <script src="js/core/validators.js"></script>

    <!-- データ管理 -->
    <script src="js/data/category-manager.js"></script>
    <script src="js/data/prompt-editor.js"></script>
    <script src="js/data/data-manager.js"></script>
    <script src="js/data/prompt-slots.js"></script>

    <!-- UI基本コンポーネント -->
    <script src="js/ui/components/ui-factory.js"></script>
    <script src="js/ui/components/ui-utilities.js"></script>
    <script src="js/ui/components/list-manager.js"></script>

    <!-- 外部連携 -->
    <script src="js/external/api-client.js"></script>
    <script src="js/external/global-utilities.js"></script>

    <!-- 個別機能 -->
    <script src="js/features/settings-manager.js"></script>
    <script src="js/features/file-handler.js"></script>
    <script src="js/features/csv-handler.js"></script>
    <script src="js/features/shortcut-manager.js"></script>
    <script src="js/features/auto-generate-handler.js"></script>

    <script src="js/ui/tabs/tab-manager.js"></script>
    <script src="js/ui/tabs/search-tab.js"></script>
    <script src="js/ui/tabs/dictionary-tab.js"></script>
    <script src="js/ui/tabs/edit-tab.js"></script>
    <script src="js/ui/tabs/slot-tab.js"></script>
    <script src="js/ui/tabs/other-tab.js"></script>

    <script src="js/features/search-handler.js"></script>
    <script src="js/features/edit-handler.js"></script>
    <script src="js/features/dictionary-handler.js"></script>

    <!-- メインスクリプト -->
    <script src="js/main.js"></script>
  </body>
</html>
