#!/usr/bin/env python3
# -*- coding: utf-8 -*-

def main():
    try:
        # 追加希望.tsvを読み込み
        with open('追加希望.tsv', 'r', encoding='utf-8') as f:
            wish_lines = f.readlines()
        
        # 第4段階: その他・修正項目を分類
        stage4_items = []
        remaining_items = []
        
        # その他・修正関連キーワードのマッピング
        other_keywords = {
            # オブジェクト・機器
            'カメラ': ('オブジェクト', '電子機器'),
            'camera': ('オブジェクト', '電子機器'),
            'iPhone': ('オブジェクト', '電子機器'),
            'iphone': ('オブジェクト', '電子機器'),
            'ビデオ': ('オブジェクト', '電子機器'),
            'video': ('オブジェクト', '電子機器'),
            'びでお': ('オブジェクト', '電子機器'),
            'ドラムを叩く': ('動作', '楽器'),
            'ドラムの椅子': ('オブジェクト', '楽器'),
            'マイクスタンド': ('オブジェクト', '楽器'),
            'microphone stand': ('オブジェクト', '楽器'),
            'パイプ': ('オブジェクト', '機械'),
            '掃除機': ('オブジェクト', '日用品'),
            'vacuum cleaner': ('オブジェクト', '日用品'),
            '雑巾': ('オブジェクト', '日用品'),
            'dust cloth': ('オブジェクト', '日用品'),
            'sheets': ('オブジェクト', '日用品'),
            '敷布団': ('オブジェクト', '家具'),
            'mattress': ('オブジェクト', '家具'),
            '抱き枕': ('オブジェクト', '家具'),
            'body pillow': ('オブジェクト', '家具'),
            'バスタオル': ('オブジェクト', '日用品'),
            'bath towels': ('オブジェクト', '日用品'),
            'テーブルクロス': ('オブジェクト', '日用品'),
            'tablecloths': ('オブジェクト', '日用品'),
            '毛布': ('オブジェクト', '日用品'),
            'blanket': ('オブジェクト', '日用品'),
            'towel blanket': ('オブジェクト', '日用品'),
            'つり革': ('オブジェクト', '公共物'),
            'straps': ('オブジェクト', '公共物'),
            '箒': ('オブジェクト', '日用品'),
            'broom': ('オブジェクト', '日用品'),
            
            # 食べ物・飲み物
            'お茶': ('食べ物', '飲み物'),
            'tea': ('食べ物', '飲み物'),
            'cup': ('オブジェクト', '日用品'),
            'アイスを食べる': ('動作', 'しぐさ'),
            'パーティー': ('シチュエーション', 'イベント'),
            'party': ('シチュエーション', 'イベント'),
            'パーティー会場': ('場所', '屋内'),
            '喫茶店': ('場所', '屋内'),
            'coffee shop': ('場所', '屋内'),
            
            # 動物・生物
            'ガニ': ('生物', '動物'),
            'crab': ('生物', '動物'),
            'クジラ': ('生物', '動物'),
            'whales': ('生物', '動物'),
            'rabbit': ('生物', '動物'),
            'rabit': ('生物', '動物'),
            'クマ': ('生物', '動物'),
            'bear': ('生物', '動物'),
            'くま': ('生物', '動物'),
            '狐': ('生物', '動物'),
            'fox': ('生物', '動物'),
            '狐尻尾': ('身体', 'しっぽ'),
            'fox tail': ('身体', 'しっぽ'),
            '子犬': ('生物', '動物'),
            'pupp': ('生物', '動物'),
            'puppy': ('生物', '動物'),
            '昆虫': ('生物', '動物'),
            'insect': ('生物', '動物'),
            '双子': ('属性', '種類'),
            'twins': ('属性', '種類'),
            '1本の尻尾': ('身体', 'しっぽ'),
            'one tail': ('身体', 'しっぽ'),
            '獣': ('属性', '種族'),
            'beast': ('属性', '種族'),
            '犬歯': ('顔', '歯'),
            'canine': ('顔', '歯'),
            
            # 自然・天候・時間
            '日焼け': ('身体', '肌'),
            'sunburn': ('身体', '肌'),
            '夕焼け': ('天候と時間帯', '時間帯'),
            '夕焼': ('天候と時間帯', '時間帯'),
            'sunset': ('天候と時間帯', '時間帯'),
            '真っ赤な太陽': ('天候と時間帯', '天気'),
            'red sun': ('天候と時間帯', '天気'),
            '飛行機雲': ('エフェクト', '自然'),
            'contrail': ('エフェクト', '自然'),
            '雲海': ('背景', '自然'),
            'sea ​​of ​​clouds': ('背景', '自然'),
            '深夜': ('天候と時間帯', '時間帯'),
            'late night': ('天候と時間帯', '時間帯'),
            'お昼': ('天候と時間帯', '時間帯'),
            'noon': ('天候と時間帯', '時間帯'),
            'air': ('エフェクト', '自然'),
            '空気': ('エフェクト', '自然'),
            'ground': ('背景', '自然'),
            '地面': ('背景', '自然'),
            '地に': ('背景', '自然'),
            'on the ground': ('背景', '自然'),
            '水辺': ('場所', '自然'),
            'waterfront': ('場所', '自然'),
            '海辺': ('場所', '自然'),
            'seaside': ('場所', '自然'),
            '水につかる': ('動作', '一般'),
            'immerse in water': ('動作', '一般'),
            '胸まで水に浸かる': ('動作', '一般'),
            'water up to one\'s chest': ('動作', '一般'),
            '水をかける': ('動作', '一般'),
            'pour water on': ('動作', '一般'),
            
            # 場所・環境
            '学校のプール': ('場所', '学校（室外）'),
            'school swimming pool': ('場所', '学校（室外）'),
            '電車の中': ('場所', '屋内'),
            'on the train': ('場所', '屋内'),
            '電車の椅子': ('オブジェクト', '公共物'),
            'train seats': ('オブジェクト', '公共物'),
            '電車のシート': ('オブジェクト', '公共物'),
            'train seat': ('オブジェクト', '公共物'),
            '道場': ('場所', '屋内'),
            'dojo': ('場所', '屋内'),
            '洞窟': ('場所', '自然'),
            'cave': ('場所', '自然'),
            '洋室': ('場所', '屋内'),
            'western-style room': ('場所', '屋内'),
            '和室': ('場所', '屋内'),
            'japanese-style room': ('場所', '屋内'),
            '大学': ('場所', '学校'),
            'university': ('場所', '学校'),
            '店の前': ('場所', '屋外'),
            'in front of the store': ('場所', '屋外'),
            '店員': ('属性', '職業'),
            'clerk': ('属性', '職業'),
            '店': ('場所', '屋内'),
            'shop': ('場所', '屋内'),
            'ダンスホール': ('場所', '屋内'),
            'dance hall': ('場所', '屋内'),
            'キャンプ': ('シチュエーション', 'イベント'),
            'camp': ('シチュエーション', 'イベント'),
            '縁日': ('シチュエーション', 'イベント'),
            'fair': ('シチュエーション', 'イベント'),
            '野球': ('シチュエーション', 'スポーツ'),
            'baseball': ('シチュエーション', 'スポーツ'),
            'バレエ': ('シチュエーション', 'ダンス'),
            'ballet': ('シチュエーション', 'ダンス'),
            'ビジネス': ('シチュエーション', '仕事'),
            'business': ('シチュエーション', '仕事'),
            'business card': ('オブジェクト', '日用品'),
            'レース場': ('場所', '屋外'),
            'racetrack': ('場所', '屋外'),
            
            # 文字・記号・効果音
            'セリフ': ('画面効果', 'ふきだし'),
            'dialogue': ('画面効果', 'ふきだし'),
            '吹き出し': ('画面効果', 'ふきだし'),
            'speech bubble': ('画面効果', 'ふきだし'),
            'オノマトペ': ('画面効果', 'ふきだし'),
            'onomatopoeia': ('画面効果', 'ふきだし'),
            '擬音': ('画面効果', 'ふきだし'),
            '効果音': ('画面効果', '特殊'),
            'sound effects': ('画面効果', '特殊'),
            'sound': ('画面効果', '特殊'),
            '言葉': ('画面効果', 'ふきだし'),
            'words': ('画面効果', 'ふきだし'),
            'もじ': ('画面効果', 'ふきだし'),
            'letters': ('画面効果', 'ふきだし'),
            '♡': ('エフェクト', 'シンボル'),
            '↑': ('エフェクト', 'シンボル'),
            '数字': ('画面効果', 'ふきだし'),
            'numbers': ('画面効果', 'ふきだし'),
            '4': ('品質', 'テンプレート'),
            '100': ('品質', 'テンプレート'),
            '1000': ('品質', 'テンプレート'),
            'M': ('品質', 'テンプレート'),
            'm': ('品質', 'テンプレート'),
            'chart': ('オブジェクト', 'デジタル'),
            
            # 年代・時代設定
            '東北': ('場所', '実在する場所（日本）'),
            'tohoku': ('場所', '実在する場所（日本）'),
            '江戸': ('テイスト', '年代'),
            'edo': ('テイスト', '年代'),
            '和風': ('テイスト', '世界観'),
            'japanese': ('テイスト', '世界観'),
            '旅籠': ('場所', '屋内'),
            '旅館': ('場所', '屋内'),
            'inn': ('場所', '屋内'),
            '東洋': ('テイスト', '世界観'),
            'eastern': ('テイスト', '世界観'),
            '原始': ('テイスト', '年代'),
            'primitive': ('テイスト', '年代'),
            '部族': ('属性', '種族'),
            'tribe': ('属性', '種族'),
            '冷戦': ('テイスト', '年代'),
            'cold war': ('テイスト', '年代'),
            
            # 人数・関係性
            '二人': ('人数', '女性'),
            'two people': ('人数', '女性'),
            'duo': ('人数', '女性'),
            '2人の女の子1人の男の子': ('人数', '男女混合'),
            '2 girls 1 boy': ('人数', '男女混合'),
            '一面': ('修飾語', '形状'),
            'one side': ('修飾語', '形状'),
            '一枚': ('修飾語', '形状'),
            '並ぶ': ('動作', 'ポーズ'),
            'line up': ('動作', 'ポーズ'),
            '縦に並ぶ': ('動作', 'ポーズ'),
            'vertical': ('動作', 'ポーズ'),
            '並んでいます': ('動作', 'ポーズ'),
            '並んで': ('動作', 'ポーズ'),
            '友達と話している': ('動作', 'しぐさ'),
            'talking to friends': ('動作', 'しぐさ'),
            '親子': ('属性', '関係'),
            'parent and child': ('属性', '関係'),
            '恋人': ('属性', '関係'),
            'lover': ('属性', '関係'),
            '父': ('属性', '関係'),
            'father': ('属性', '関係'),
            
            # 色・材質・テクスチャ
            'ハイライト': ('色', '色'),
            'highlights': ('色', '色'),
            'コントラスト': ('色', '色'),
            'contrast': ('色', '色'),
            '美白': ('色', '白系'),
            'whitening': ('色', '白系'),
            '木目': ('修飾語', '材質'),
            'grain': ('修飾語', '材質'),
            'サテン': ('修飾語', '材質'),
            'satin': ('修飾語', '材質'),
            'ラバー': ('修飾語', '材質'),
            'rubber': ('修飾語', '材質'),
            'えなめる': ('修飾語', '材質'),
            'enamel': ('修飾語', '材質'),
            'mesh': ('修飾語', '材質'),
            'vinyl': ('修飾語', '材質'),
            'ビニール': ('修飾語', '材質'),
            'コンクリート': ('修飾語', '材質'),
            'concrete': ('修飾語', '材質'),
            'textile': ('修飾語', '材質'),
            '厚地': ('修飾語', '材質'),
            'thick': ('修飾語', '材質'),
            '太い': ('修飾語', '形状'),
            '細め': ('修飾語', '形状'),
            'thin': ('修飾語', '形状'),
            '痩せ': ('修飾語', '形状'),
            '痩せた': ('修飾語', '形状'),
            'lost weight': ('修飾語', '形状'),
            '小さい': ('修飾語', '形状'),
            '小顔': ('修飾語', '形状'),
            '半分': ('修飾語', '形状'),
            'half': ('修飾語', '形状'),
            '完璧': ('修飾語', '形容詞'),
            'perfection': ('修飾語', '形容詞'),
            '同じ': ('修飾語', '形容詞'),
            'same': ('修飾語', '形容詞'),
            '同一': ('修飾語', '形容詞'),
            'identical': ('修飾語', '形容詞'),
            
            # 身体・生理機能
            '体毛': ('身体', '肌'),
            'body hair': ('身体', '肌'),
            '汚れた肌': ('身体', '肌'),
            '泥汚れ': ('身体', '肌'),
            'テカリ': ('身体', '肌'),
            '呼吸': ('身体', '一般'),
            'breathing': ('身体', '一般'),
            '荒い': ('身体', '一般'),
            'rough': ('身体', '一般'),
            '発射': ('身体', '一般'),
            'firing': ('身体', '一般'),
            '背骨': ('身体', '胴'),
            'spine': ('身体', '胴'),
            '背筋': ('身体', '筋肉'),
            'back muscles': ('身体', '筋肉'),
            'うなじ': ('身体', '頭部'),
            'nape': ('身体', '頭部'),
            '手のひら': ('身体', '手'),
            'palm': ('身体', '手'),
            '爪': ('身体', '手'),
            'fingernails': ('身体', '手'),
            'nail': ('身体', '手'),
            '腰': ('身体', '胴'),
            'waist': ('身体', '胴'),
            'あばら': ('身体', '胴'),
            'rib': ('身体', '胴'),
            '肌': ('身体', '肌'),
            'skin': ('身体', '肌'),
            '脂肪': ('身体', '一般'),
            'fat': ('身体', '一般'),
            'あびる': ('動作', 'しぐさ'),
            'bathe': ('動作', 'しぐさ'),
            
            # 動作・行為
            '胴上げ': ('動作', '一般'),
            'tossing someone up in the air': ('動作', '一般'),
            '背負う': ('動作', '手・腕の動作'),
            'bear': ('動作', '手・腕の動作'),
            '鞄を背負う': ('動作', '手・腕の動作'),
            'carry a bag': ('動作', '手・腕の動作'),
            '階段を上る': ('動作', '移動'),
            'climbing the stairs': ('動作', '移動'),
            '雑巾がけ': ('動作', '一般'),
            'mopping': ('動作', '一般'),
            '床を拭く': ('動作', '一般'),
            'mopping the floor': ('動作', '一般'),
            '拭く': ('動作', '一般'),
            'wipe': ('動作', '一般'),
            '噛む': ('動作', 'しぐさ'),
            'bite': ('動作', 'しぐさ'),
            'biting': ('動作', 'しぐさ'),
            '煙草をくわえる': ('動作', 'しぐさ'),
            'hold a cigarette in your mouth': ('動作', 'しぐさ'),
            'タバコを咥える': ('動作', 'しぐさ'),
            'タバコを吸える': ('動作', 'しぐさ'),
            'smoking': ('動作', 'しぐさ'),
            '食い': ('動作', 'しぐさ'),
            'eat': ('動作', 'しぐさ'),
            '吐く': ('動作', 'しぐさ'),
            'vomit': ('動作', 'しぐさ'),
            '眠って': ('動作', 'ポーズ'),
            'asleep': ('動作', 'ポーズ'),
            'sleeping': ('動作', 'ポーズ'),
            '添い寝': ('動作', 'ポーズ'),
            'sleeping together': ('動作', 'ポーズ'),
            '祈る': ('動作', 'しぐさ'),
            'pray': ('動作', 'しぐさ'),
            'playing': ('動作', 'しぐさ'),
            '遊ぶ': ('動作', 'しぐさ'),
            'play': ('動作', 'しぐさ'),
            'くすぐる': ('動作', 'しぐさ'),
            'tickle': ('動作', 'しぐさ'),
            '撫で': ('動作', 'しぐさ'),
            '撫でる': ('動作', 'しぐさ'),
            'petting': ('動作', 'しぐさ'),
            'ナデナデ': ('動作', 'しぐさ'),
            'なでる': ('動作', 'しぐさ'),
            'pet': ('動作', 'しぐさ'),
            'Scoop with hands': ('動作', '手・腕の動作'),
            'scoop with hands': ('動作', '手・腕の動作'),
            'smelling': ('動作', 'しぐさ'),
            '倒れる': ('動作', 'ポーズ'),
            'fall down': ('動作', 'ポーズ'),
            '畳む': ('動作', '一般'),
            'fold': ('動作', '一般'),
            
            # 袋・容器
            'スーパーの袋': ('オブジェクト', '日用品'),
            'supermarket bag': ('オブジェクト', '日用品'),
            'ビニール袋': ('オブジェクト', '日用品'),
            'plastic bags': ('オブジェクト', '日用品'),
            'チラシ': ('オブジェクト', '日用品'),
            'flyer': ('オブジェクト', '日用品'),
            'チラシを拾う': ('動作', '一般'),
            'pick up a flyer': ('動作', '一般'),
            'お札': ('オブジェクト', '小物'),
            'bill': ('オブジェクト', '小物'),
            '紙幣': ('オブジェクト', '小物'),
            'お金': ('オブジェクト', '小物'),
            'money': ('オブジェクト', '小物'),
            '皿': ('オブジェクト', '日用品'),
            'dish': ('オブジェクト', '日用品'),
            'plate': ('オブジェクト', '日用品'),
            
            # その他一般語
            'らくがき': ('動作', '一般'),
            'scribble': ('動作', '一般'),
            '散乱': ('修飾語', '状態'),
            'scattering': ('修飾語', '状態'),
            'scatter': ('修飾語', '状態'),
            '潰れた': ('修飾語', '状態'),
            'collapsed': ('修飾語', '状態'),
            '腫れる': ('修飾語', '状態'),
            'swelling': ('修飾語', '状態'),
            '膨れ': ('修飾語', '状態'),
            '弾む': ('動作', '一般'),
            'bounce': ('動作', '一般'),
            'bounc': ('動作', '一般'),
            '巻きつく': ('動作', '一般'),
            'wrap around': ('動作', '一般'),
            '伸びる': ('動作', '一般'),
            'extend': ('動作', '一般'),
            '弛緩': ('修飾語', '状態'),
            'flaccid': ('修飾語', '状態'),
            'manicure': ('動作', 'しぐさ'),
            '微調整': ('動作', '一般'),
            'tweak': ('動作', '一般'),
            '録画': ('動作', '一般'),
            'recording': ('動作', '一般'),
            '配信': ('動作', '一般'),
            'delivery': ('動作', '一般'),
            'streaming': ('動作', '一般'),
            '検閲': ('動作', '一般'),
            'censorship': ('動作', '一般'),
            '証明': ('動作', '一般'),
            'proof': ('動作', '一般'),
            '整備': ('動作', '一般'),
            'maintenance': ('動作', '一般'),
            
            # 性格・感情（ポジティブ）
            'ラブラブ': ('表情・感情', 'ポジティブな感情'),
            'love love': ('表情・感情', 'ポジティブな感情'),
            'ラヴ': ('表情・感情', 'ポジティブな感情'),
            'love': ('表情・感情', 'ポジティブな感情'),
            'だいしゅき': ('表情・感情', 'ポジティブな感情'),
            'i love you': ('表情・感情', 'ポジティブな感情'),
            'ようこそ': ('表情・感情', 'ポジティブな感情'),
            'welcome': ('表情・感情', 'ポジティブな感情'),
            
            # 複雑な感情・属性
            '不満': ('表情・感情', 'ネガティブな感情'),
            'dissatisfaction': ('表情・感情', 'ネガティブな感情'),
            '嫉妬深い': ('表情・感情', 'ネガティブな感情'),
            'jealous': ('表情・感情', 'ネガティブな感情'),
            '酔': ('表情・感情', 'リラックス'),
            'drunk': ('表情・感情', 'リラックス'),
            'dead drunk': ('表情・感情', 'リラックス'),
            '静かに': ('表情・感情', 'リラックス'),
            'quietly': ('表情・感情', 'リラックス'),
            'シーッ': ('表情・感情', 'その他'),
            'shhhh': ('表情・感情', 'その他'),
            'しー': ('表情・感情', 'その他'),
            'shi': ('表情・感情', 'その他'),
            '辛い': ('表情・感情', 'ネガティブな感情'),
            'spicy': ('表情・感情', 'ネガティブな感情'),
            '激しい': ('表情・感情', 'ポジティブな感情'),
            'intense': ('表情・感情', 'ポジティブな感情'),
            
            # 特殊記号・プロンプト
            'nsfw': ('品質', '低品質成人向け'),
            'NSFW': ('品質', '低品質成人向け'),
            'masterpiece': ('品質', '高品質'),
            'master piece': ('品質', '高品質'),
            'master': ('品質', '高品質'),
            'best quality': ('品質', '高品質'),
            'high quality': ('品質', '高品質'),
            'official': ('品質', '高品質'),
            '公式': ('品質', '高品質'),
            'highly detailed': ('品質', '高品質'),
            'detailed': ('品質', '高品質'),
            'ultra-detailed': ('品質', '高品質'),
            'perfect': ('品質', '高品質'),
            'amazing': ('品質', '高品質'),
            'aesthetic': ('品質', 'aesthetic'),
            'very aesthetic': ('品質', 'aesthetic'),
            'intricate': ('品質', '高品質'),
            'depth of field': ('カメラワーク', '効果'),
            'motion lines': ('エフェクト', 'エフェクト'),
            'uncensored': ('品質', '高品質'),
            'explicit': ('品質', '低品質成人向け'),
            'score': ('品質', 'テンプレート'),
            'copyright': ('品質', 'メタ'),
            
            # その他略語・記号
            'cm': ('修飾語', '形状'),
            '㊦': ('品質', 'テンプレート'),
            'UC': ('品質', 'テンプレート'),
            'u.c.': ('品質', 'テンプレート'),
            'ｇ': ('品質', 'テンプレート'),
            'g': ('品質', 'テンプレート'),
            ';>': ('エフェクト', 'シンボル'),
            
            # ジャンル・作品
            'アイマス': ('作品', '作品名'),
            'idolmaster': ('作品', '作品名'),
            'アイドルマスター': ('作品', '作品名'),
            'the idolmaster': ('作品', '作品名'),
            'ポケモン': ('作品', '作品名'),
            'pokémon': ('作品', '作品名'),
            'pokemon': ('作品', '作品名'),
            'アメコミ': ('テイスト', '絵柄'),
            '絵柄': ('テイスト', '絵柄'),
            'pictorial pattern': ('テイスト', '絵柄'),
            
            # 医療・治療
            '出産': ('シチュエーション', 'グロテスク'),
            'childbirth': ('シチュエーション', 'グロテスク'),
            '焼印': ('装飾', '傷病'),
            'branding': ('装飾', '傷病'),
            '焼かれた': ('装飾', '傷病'),
            'burned': ('装飾', '傷病'),
            '傷': ('装飾', '傷病'),
            'scratch': ('装飾', '傷病'),
            'wound': ('装飾', '傷病'),
            '絆創膏を剥がす': ('動作', '一般'),
            'remove the bandage': ('動作', '一般'),
            '絆創膏をめくる': ('動作', '一般'),
            'bandage': ('装飾', '傷病'),
            '保健': ('シチュエーション', '学校'),
            'health': ('シチュエーション', '学校'),
            '教育': ('シチュエーション', '学校'),
            'education': ('シチュエーション', '学校'),
            'educ': ('シチュエーション', '学校'),
            'eju': ('シチュエーション', '学校'),
            
            # その他固有名詞・人名
            'サンライズ': ('テイスト', 'デザイナー'),
            'sunrise': ('テイスト', 'デザイナー'),
            'Remilia': ('キャラクター', '東方'),
            'remilia': ('キャラクター', '東方'),
            'narmaya': ('キャラクター', 'グランブルーファンタジー'),
            'ナイチン': ('キャラクター', 'その他'),
            'nightingale': ('キャラクター', 'その他'),
            'アニラ': ('キャラクター', 'グランブルーファンタジー'),
            'anira': ('キャラクター', 'グランブルーファンタジー'),
            'klonoa': ('キャラクター', 'その他'),
            '加藤': ('キャラクター', 'その他'),
            'kato': ('キャラクター', 'その他'),
            '有馬': ('キャラクター', 'その他'),
            'arima': ('キャラクター', 'その他'),
            '篝': ('キャラクター', 'その他'),
            'kagari': ('キャラクター', 'その他'),
            'クリスティーナ': ('キャラクター', 'その他'),
            'christina': ('キャラクター', 'その他'),
            '朝凪': ('テイスト', 'デザイナー'),
            '艦これ': ('作品', '作品名'),
            'kantai collection': ('作品', '作品名'),
            'ブルーアーカイブ': ('作品', '作品名'),
            'blue archive': ('作品', '作品名'),
            'buru-a-kaibu': ('作品', '作品名'),
            'ホタル': ('キャラクター', 'その他'),
            'firefly': ('キャラクター', 'その他'),
            'スターレイル': ('作品', '作品名'),
            'star rail': ('作品', '作品名'),
            '鬼頭': ('キャラクター', 'その他'),
            'kito': ('キャラクター', 'その他'),
            '東北イタコ': ('キャラクター', 'VOICE BOX'),
            'tohoku itako': ('キャラクター', 'VOICE BOX'),
            '織姫': ('キャラクター', 'その他'),
            '鳥山': ('テイスト', 'デザイナー'),
            'toriyama': ('テイスト', 'デザイナー'),
            'asus': ('オブジェクト', '電子機器'),
            'エプソン': ('オブジェクト', '電子機器'),
            'epson': ('オブジェクト', '電子機器'),
            
            # オノマトペ・その他音
            'Nightcore Mix': ('画面効果', '特殊'),
            'nightcore mix': ('画面効果', '特殊'),
            
            # その他未分類
            '誘惑': ('動作', 'しぐさ'),
            'temptation': ('動作', 'しぐさ'),
            '挑発': ('動作', 'しぐさ'),
            'taunt': ('動作', 'しぐさ'),
            '援助': ('シチュエーション', 'シチュ'),
            'assistance': ('シチュエーション', 'シチュ'),
            '職種': ('属性', '職業'),
            'job type': ('属性', '職業'),
            '悔しい': ('表情・感情', 'ネガティブな感情'),
            'regrettable': ('表情・感情', 'ネガティブな感情'),
            '悔': ('表情・感情', 'ネガティブな感情'),
            'regret': ('表情・感情', 'ネガティブな感情'),
            '勝利': ('表情・感情', 'ポジティブな感情'),
            'victory': ('表情・感情', 'ポジティブな感情'),
            '悪党': ('属性', '性質'),
            'villain': ('属性', '性質'),
            '本物': ('修飾語', '形容詞'),
            'real': ('修飾語', '形容詞'),
            '雰囲気': ('修飾語', '形容詞'),
            'atmosphere': ('修飾語', '形容詞'),
            '結婚': ('シチュエーション', 'イベント'),
            'marriage': ('シチュエーション', 'イベント'),
            'wedding': ('シチュエーション', 'イベント'),
            '結婚式': ('シチュエーション', 'イベント'),
            'wedding ceremony': ('シチュエーション', 'イベント'),
            '神': ('属性', '種族'),
            'god': ('属性', '種族'),
            '伝説': ('修飾語', '形容詞'),
            'legend': ('修飾語', '形容詞'),
            '景色': ('背景', '自然'),
            'scenery': ('背景', '自然'),
            'view': ('背景', '自然'),
            
            # その他の複雑プロンプト
            'nsfw,{{{{toon}}}},{{{{thick coating}}}},1girl,{{{{child}}}},{{{{flat chest}}}},{{{{{upper body}}}}},low angle,{{slim legs}}}': ('品質', '低品質成人向け'),
            'doujin cover': ('品質', 'メタ'),
            'alternate costume': ('服装', '一式'),
            'Completely naked': ('服装', '裸'),
            'completely naked': ('服装', '裸'),
            'catlike eyes': ('顔', '目'),
            'cat-like eyes': ('顔', '目'),
            
            # 位置・方向
            '位': ('修飾語', '位置'),
            'rank': ('修飾語', '位置'),
            '上位': ('修飾語', '位置'),
            'top': ('修飾語', '位置'),
            '後': ('修飾語', '位置'),
            'rear': ('修飾語', '位置'),
            '後ろ': ('修飾語', '位置'),
            'behind': ('修飾語', '位置'),
            '右向き': ('修飾語', '位置'),
            '前で': ('修飾語', '位置'),
            'in front': ('修飾語', '位置'),
            '近': ('修飾語', '位置'),
            'near': ('修飾語', '位置'),
            '距離': ('修飾語', '位置'),
            'distance': ('修飾語', '位置'),
            '向': ('修飾語', '位置'),
            'direction': ('修飾語', '位置'),
            'facing': ('修飾語', '位置'),
            'facing to the side': ('修飾語', '位置'),
            '向かい合う': ('動作', 'ポーズ'),
            'face to face': ('動作', 'ポーズ'),
            '離れる': ('動作', 'ポーズ'),
            'leave': ('動作', 'ポーズ'),
            '離れ': ('動作', 'ポーズ'),
            'annex': ('動作', 'ポーズ'),
            '離れた': ('動作', 'ポーズ'),
            'departed': ('動作', 'ポーズ'),
            '渡す': ('動作', 'しぐさ'),
            'hand over': ('動作', 'しぐさ'),
            'こっそり': ('動作', 'しぐさ'),
            'secretly': ('動作', 'しぐさ'),
            
            # その他の動詞・形容詞
            'looking': ('動作', '視線'),
            'stand': ('動作', 'ポーズ'),
            'standing': ('動作', 'ポーズ'),
            '立': ('動作', 'ポーズ'),
            'bend': ('動作', 'ポーズ'),
            '曲がる': ('動作', 'ポーズ'),
            '曲げる': ('動作', 'ポーズ'),
            'bending': ('動作', 'ポーズ'),
            'しなる': ('動作', 'ポーズ'),
            'twist': ('動作', 'ポーズ'),
            'lean': ('動作', 'ポーズ'),
            '後ろに寄りかかる': ('動作', 'ポーズ'),
            'lean back': ('動作', 'ポーズ'),
            'もたれる': ('動作', 'ポーズ'),
            'もたれ': ('動作', 'ポーズ'),
            '体勢': ('動作', 'ポーズ'),
            'posture': ('動作', 'ポーズ'),
            
            # その他記号・略語
            'adult': ('年齢', '男女共通'),
            '大人': ('年齢', '男女共通'),
            '大人大人': ('年齢', '男女共通'),
            '大人の女性': ('年齢', '女性'),
            'adult women': ('年齢', '女性'),
            '年齢': ('年齢', '年齢指定'),
            'age': ('年齢', '年齢指定'),
            '年差': ('年齢', '年齢指定'),
            'age gap': ('年齢', '年齢指定'),
            'ジュニア': ('年齢', '男女共通'),
            'junior': ('年齢', '男女共通'),
            '赤ちゃん': ('年齢', '男女共通'),
            'baby': ('年齢', '男女共通'),
            '子供': ('年齢', '男女共通'),
            'child': ('年齢', '男女共通'),
            'children': ('年齢', '男女共通'),
            
            # 英語略語・誤字修正
            'uni': ('品質', 'テンプレート'),
            'grub': ('オブジェクト', '日用品'),
            'グラブ': ('オブジェクト', '日用品'),
            'venus': ('キャラクター', 'その他'),
            'cleft': ('身体', '一般'),
            'ツイスタ': ('オブジェクト', '機械'),
            'twister': ('オブジェクト', '機械'),
            'faceles': ('修飾語', '形容詞'),
            'faceless': ('修飾語', '形容詞'),
            '顔のない': ('修飾語', '形容詞'),
            'せ': ('動作', '視線'),
            '視線': ('動作', '視線'),
            'eye contact': ('動作', '視線'),
            'spok': ('オブジェクト', '機械'),
            'spoke': ('オブジェクト', '機械'),
            'スポーク': ('オブジェクト', '機械'),
            
            # その他詳細分類
            '全体': ('修飾語', '形状'),
            'whole': ('修飾語', '形状'),
            '全裸': ('服装', '裸'),
            'naked': ('服装', '裸'),
            'nude': ('服装', '裸'),
            '丸出し': ('服装', '裸'),
            'fully exposed': ('服装', '裸'),
            '露出する': ('服装', '露出度'),
            '露出': ('服装', '露出度'),
            'exposure': ('服装', '露出度'),
            'exposed': ('服装', '露出度'),
            '晒し': ('服装', '露出度'),
            'exposing': ('服装', '露出度'),
            'public': ('シチュエーション', 'シチュ'),
            '公衆': ('シチュエーション', 'シチュ'),
            '公': ('シチュエーション', 'シチュ'),
            
            # 技術用語
            'X線': ('カメラワーク', '技術的'),
            'x-ray': ('カメラワーク', '技術的'),
            'xray': ('カメラワーク', '技術的'),
            '射影': ('カメラワーク', '技術的'),
            'projection': ('カメラワーク', '技術的'),
            '構造': ('カメラワーク', '技術的'),
            'structure': ('カメラワーク', '技術的'),
            'cross-section': ('カメラワーク', '技術的'),
            'cut-in': ('画面効果', '特殊'),
            'ノイズ': ('画面効果', '特殊'),
            'noise': ('画面効果', '特殊'),
            'minimal background': ('背景', '背景'),
            'pillarboxed': ('画面効果', '枠'),
            'ビューワ': ('オブジェクト', '電子機器'),
            'viewer': ('オブジェクト', '電子機器'),
            'interface': ('オブジェクト', 'デジタル'),
            
            # その他の動作・感情
            'きしむ': ('動作', 'しぐさ'),
            'squee': ('動作', 'しぐさ'),
            'squeeze': ('動作', 'しぐさ'),
            'しがみつく': ('動作', '手・腕の動作'),
            'cling': ('動作', '手・腕の動作'),
            'しがみ': ('動作', '手・腕の動作'),
            'shigami': ('動作', '手・腕の動作'),
            '吹き飛ぶ': ('動作', '移動'),
            'blown away': ('動作', '移動'),
            '飛ばされる': ('動作', '移動'),
            'to be blown away': ('動作', '移動'),
            '集中': ('表情・感情', '真剣な表情・感情'),
            'concentration': ('表情・感情', '真剣な表情・感情'),
            'concentrate': ('表情・感情', '真剣な表情・感情'),
            '慎重': ('表情・感情', '真剣な表情・感情'),
            'careful': ('表情・感情', '真剣な表情・感情'),
            '致命的': ('修飾語', '形容詞'),
            'fatal': ('修飾語', '形容詞'),
            'deadly': ('修飾語', '形容詞'),
            
            # 位置関係・空間
            '画面外': ('カメラワーク', 'フレーム'),
            'off screen': ('カメラワーク', 'フレーム'),
            '画面に': ('カメラワーク', 'フレーム'),
            'on the screen': ('カメラワーク', 'フレーム'),
            '壁に': ('場所', '屋内'),
            'on the wall': ('場所', '屋内'),
            'on wall': ('場所', '屋内'),
            '壁に手をつく': ('動作', '手・腕の動作'),
            'put your hands on the wall': ('動作', '手・腕の動作'),
            'against glass': ('場所', '屋内'),
            'through': ('修飾語', '位置'),
            'Through': ('修飾語', '位置'),
            'around': ('修飾語', '位置'),
            '周り': ('修飾語', '位置'),
            'surrounding': ('修飾語', '位置'),
            'partially underwater': ('場所', '自然'),
            'underwater': ('場所', '自然'),
            '水中': ('場所', '自然'),
            
            # その他複雑な表現
            'kabedon': ('動作', 'しぐさ'),
            'ツーショット': ('カメラワーク', '構図'),
            'two shots': ('カメラワーク', '構図'),
            '直前': ('修飾語', '時間'),
            'last minute': ('修飾語', '時間'),
            'imminent': ('修飾語', '時間'),
            'あいまい': ('修飾語', '形容詞'),
            '曖昧': ('修飾語', '形容詞'),
            'ambiguous': ('修飾語', '形容詞'),
            'Upside-Down': ('動作', 'ポーズ'),
            'upside-down': ('動作', 'ポーズ'),
            'Backlit': ('照明', '方向'),
            'backlit': ('照明', '方向'),
            'backlighting': ('照明', '方向'),
            '逆光': ('照明', '方向'),
            'invisible air': ('エフェクト', '光'),
            'visible air': ('エフェクト', '光'),
            'clear liquid': ('エフェクト', '液体'),
            'Airy': ('修飾語', '形容詞'),
            'airy': ('修飾語', '形容詞'),
            'exhaustion': ('表情・感情', 'ネガティブな感情'),
            'tired': ('表情・感情', 'ネガティブな感情'),
            '疲労': ('表情・感情', 'ネガティブな感情'),
            
            # 抽象概念
            '空想': ('テイスト', '世界観'),
            'fantasy': ('テイスト', '世界観'),
            'imagination': ('テイスト', '世界観'),
            '退廃的': ('テイスト', '世界観'),
            'decadent': ('テイスト', '世界観'),
            'decadence': ('テイスト', '世界観'),
            '下品': ('修飾語', '形容詞'),
            'vulgar': ('修飾語', '形容詞'),
            'obscene': ('修飾語', '形容詞'),
            '静止している': ('動作', 'ポーズ'),
            '静止': ('動作', 'ポーズ'),
            'static': ('動作', 'ポーズ'),
            'still': ('動作', 'ポーズ'),
            
            # 未分類の英語
            'skim': ('動作', '一般'),
            'pile': ('修飾語', '形状'),
            'elasticized': ('修飾語', '材質'),
            'elastic': ('修飾語', '材質'),
            'pur': ('品質', 'テンプレート'),
            'pure': ('品質', 'テンプレート'),
            'grbb': ('品質', 'テンプレート'),
            'grra': ('品質', 'テンプレート'),
            'tip on': ('品質', 'テンプレート'),
            'overf': ('品質', 'テンプレート'),
            'overflow': ('品質', 'テンプレート'),
            'fixedly': ('修飾語', '形容詞'),
            'fixed': ('修飾語', '形容詞'),
            'ハイグレ': ('品質', '高品質'),
            'high grade': ('品質', '高品質'),
            'リード': ('動作', '一般'),
            'lead': ('動作', '一般'),
            'leading': ('動作', '一般'),
            'present': ('動作', '一般'),
            'むく': ('動作', 'しぐさ'),
            'muku': ('動作', 'しぐさ'),
            'invite': ('動作', 'しぐさ'),
            'invitation': ('動作', 'しぐさ'),
            'defeated': ('表情・感情', 'ネガティブな感情'),
            '敗れた': ('表情・感情', 'ネガティブな感情'),
            'victory': ('表情・感情', 'ポジティブな感情'),
            '逆行': ('動作', '一般'),
            'retrograde': ('動作', '一般'),
            '旨を隠す': ('動作', '一般'),
            'hide the meaning': ('動作', '一般'),
            
            # 更に詳細な修正・英語誤字
            'hetelo': ('品質', 'テンプレート'),
            'heteron': ('品質', 'テンプレート'),
            'san': ('品質', 'テンプレート'),
            'son': ('品質', 'テンプレート'),
            'ladc': ('品質', 'テンプレート'),
            'スリー': ('品質', 'テンプレート'),
            'slley': ('品質', 'テンプレート'),
            'noke': ('品質', 'テンプレート'),
            'のけ': ('品質', 'テンプレート'),
            'ノケ': ('品質', 'テンプレート'),
            '薄い': ('修飾語', '形状'),
            '薄': ('修飾語', '形状'),
            'ranndoseru': ('オブジェクト', '日用品'),
            'randoseru': ('オブジェクト', '日用品'),
            'くぱ': ('成人向け', 'ポーズ'),
            'kupa': ('成人向け', 'ポーズ'),
            '吸う': ('動作', 'しぐさ'),
            'inhale': ('動作', 'しぐさ'),
            'leaning': ('動作', 'ポーズ'),
            'spread': ('動作', 'ポーズ'),
            '種': ('オブジェクト', '自然物'),
            'seed': ('オブジェクト', '自然物'),
            '埋': ('動作', '一般'),
            'buried': ('動作', '一般'),
            'bury': ('動作', '一般'),
            'daki': ('動作', 'しぐさ'),
            '抱き': ('動作', 'しぐさ'),
            'hug': ('動作', 'しぐさ'),
            'たいい': ('品質', 'テンプレート'),
            'taii': ('品質', 'テンプレート'),
            'だn': ('品質', 'テンプレート'),
            'it\'s': ('品質', 'テンプレート'),
            'レイヤー': ('品質', 'テンプレート'),
            'layers': ('品質', 'テンプレート'),
            'layer': ('品質', 'テンプレート'),
            '冴えない': ('修飾語', '形容詞'),
            'dull': ('修飾語', '形容詞'),
            'プリコ園': ('場所', '屋外'),
            'purikoen': ('場所', '屋外'),
            'grabbing another\'s': ('動作', '手・腕の動作'),
            'grabbing': ('動作', '手・腕の動作'),
            'cyclops': ('属性', '種族'),
            'from back': ('動作', 'ポーズ'),
            'anfall': ('動作', 'ポーズ'),
            '陥没': ('修飾語', '状態'),
            'collapse': ('修飾語', '状態'),
            'penis awe': ('成人向け', '表情'),
            'oibttauk': ('品質', 'テンプレート'),
            'bu': ('品質', 'テンプレート'),
            'penids': ('品質', 'テンプレート'),
            'basquet': ('シチュエーション', 'スポーツ'),
            'basket': ('シチュエーション', 'スポーツ'),
            'basketball': ('シチュエーション', 'スポーツ'),
            'スティ': ('品質', 'テンプレート'),
            'suti': ('品質', 'テンプレート'),
            'ニプ': ('成人向け', '胸'),
            'nip': ('成人向け', '胸'),
            'nipple': ('成人向け', '胸'),
            '生き': ('修飾語', '形容詞'),
            'living': ('修飾語', '形容詞'),
            'alive': ('修飾語', '形容詞'),
            'オランダ語': ('修飾語', '言語'),
            'dutch': ('修飾語', '言語'),
        }
        
        # 処理済み項目
        processed_items = set()
        
        # 各行をチェックして分類
        for line in wish_lines:
            line = line.strip()
            if not line:
                continue
                
            parts = line.split('\t')
            if len(parts) >= 4:
                大項目_orig = parts[0]
                中項目_orig = parts[1]
                小項目 = parts[2]
                prompt = parts[3]
            elif len(parts) == 3:
                大項目_orig = ""
                中項目_orig = parts[0]
                小項目 = parts[1]
                prompt = parts[2]
            elif len(parts) == 2:
                大項目_orig = ""
                中項目_orig = ""
                小項目 = parts[0]
                prompt = parts[1]
            else:
                continue
            
            # キーワードマッチング
            matched = False
            for keyword, (大項目, 中項目) in other_keywords.items():
                if keyword in 小項目 or keyword in prompt:
                    stage4_items.append(f"{大項目}\t{中項目}\t{小項目}\t{prompt}")
                    processed_items.add(小項目)
                    matched = True
                    break
            
            if not matched:
                remaining_items.append(line)
        
        print(f"第4段階: {len(stage4_items)}個の項目を抽出しました")
        
        # マスターデータに追加
        if stage4_items:
            with open('マスターデータ.tsv', 'a', encoding='utf-8') as f:
                for item in stage4_items:
                    f.write(item + '\n')
            print(f"マスターデータに{len(stage4_items)}個の項目を追加しました")
        
        # 残り項目を追加希望.tsvに書き戻し
        with open('追加希望.tsv', 'w', encoding='utf-8') as f:
            for item in remaining_items:
                f.write(item + '\n')
        
        print(f"残り項目数: {len(remaining_items)}")
        
        # 残り項目を未登録項目.tsvに移動
        if remaining_items:
            with open('未登録項目.tsv', 'w', encoding='utf-8') as f:
                for item in remaining_items:
                    f.write(item + '\n')
            print(f"残り{len(remaining_items)}個の項目を未登録項目.tsvに移動しました")
        
        # 追加希望.tsvをクリア
        with open('追加希望.tsv', 'w', encoding='utf-8') as f:
            pass
        print("追加希望.tsvをクリアしました")
        
    except Exception as e:
        print(f"エラーが発生しました: {e}")

if __name__ == "__main__":
    main()