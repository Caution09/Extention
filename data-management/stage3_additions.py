#!/usr/bin/env python3
# -*- coding: utf-8 -*-

def main():
    try:
        # 追加希望.tsvを読み込み
        with open('追加希望.tsv', 'r', encoding='utf-8') as f:
            wish_lines = f.readlines()
        
        # 第3段階: 成人向け・シチュエーション系の項目を分類
        stage3_items = []
        remaining_items = []
        
        # 成人向け・シチュエーション関連キーワードのマッピング
        adult_situation_keywords = {
            # 成人向け基本
            '素股': ('成人向け', '前戯'),
            '娼館': ('シチュエーション', 'シチュ'),
            'restraint': ('成人向け', 'SM'),
            '縛る': ('成人向け', 'SM'),
            '首絞め': ('成人向け', 'SM'),
            '抑えつけ': ('成人向け', 'SM'),
            '強制': ('成人向け', 'SM'),
            'handcuffs': ('成人向け', 'SM'),
            'bondage': ('成人向け', 'SM'),
            
            # 成人向け性器・身体
            '巨根': ('成人向け', '性器'),
            '勃起': ('成人向け', '性器'),
            'もっこり': ('成人向け', '性器'),
            '包茎': ('成人向け', '性器'),
            '仮生包茎': ('成人向け', '性器'),
            '仮性包茎': ('成人向け', '性器'),
            '包皮': ('成人向け', '性器'),
            'foreskin': ('成人向け', '性器'),
            'foreskin penis': ('成人向け', '性器'),
            '陰嚢': ('成人向け', '性器'),
            'キンタマ': ('成人向け', '性器'),
            'balls': ('成人向け', '性器'),
            'penis': ('成人向け', '性器'),
            'cock': ('成人向け', '性器'),
            'dick': ('成人向け', '性器'),
            'ペニス': ('成人向け', '性器'),
            '尿道': ('成人向け', '性器'),
            '尿道攻め': ('成人向け', 'プレイ'),
            '精液': ('成人向け', '射精'),
            'cum': ('成人向け', '射精'),
            'semen': ('成人向け', '射精'),
            '射精': ('成人向け', '射精'),
            '発射': ('成人向け', '射精'),
            '顔に精液': ('成人向け', '射精'),
            '顔面射精': ('成人向け', '射精'),
            'facial': ('成人向け', '射精'),
            'internal cumshot': ('成人向け', '射精'),
            'cum in mouth': ('成人向け', '射精'),
            'cum in headwear': ('成人向け', '射精'),
            'cun in headwear': ('成人向け', '射精'),
            'cum overflow': ('成人向け', '射精'),
            'excessive cum': ('成人向け', '射精'),
            'cum on mouth': ('成人向け', '射精'),
            'cream pie': ('成人向け', '射精'),
            
            # 乳首・胸関連
            '乳首が立っている': ('成人向け', '胸'),
            '乳首が勃つ': ('成人向け', '胸'),
            '乳首舐め': ('成人向け', '前戯'),
            'nipple licking': ('成人向け', '前戯'),
            '乳首吸う': ('成人向け', '前戯'),
            'nipple sucking': ('成人向け', '前戯'),
            'sucking nipples': ('成人向け', '前戯'),
            'nipple tweak': ('成人向け', '前戯'),
            'show off nipples': ('成人向け', '胸'),
            'nipple line': ('成人向け', '胸'),
            '乳首の線': ('成人向け', '胸'),
            'nipple': ('成人向け', '胸'),
            '乳輪': ('成人向け', '胸'),
            'areola': ('成人向け', '胸'),
            'areolae': ('成人向け', '胸'),
            '巨大な乳輪': ('成人向け', '胸'),
            'huge areolae': ('成人向け', '胸'),
            'erectile': ('成人向け', '胸'),
            '胸もむ': ('成人向け', '前戯'),
            '胸をもむ': ('成人向け', '前戯'),
            '胸で挟む': ('成人向け', '前戯'),
            '揺れる胸': ('成人向け', '胸'),
            'breast shaking': ('成人向け', '胸'),
            '乳揺れ': ('成人向け', '胸'),
            'shaking breasts': ('成人向け', '胸'),
            '胸を出した': ('成人向け', '胸'),
            'breast out': ('成人向け', '胸'),
            'breasts': ('成人向け', '胸'),
            'brests': ('成人向け', '胸'),
            'brest': ('成人向け', '胸'),
            'tits': ('成人向け', '胸'),
            't乳': ('成人向け', '胸'),
            't breasts': ('成人向け', '胸'),
            '貧乳': ('成人向け', '胸'),
            'flat chest': ('成人向け', '胸'),
            '中くらいの胸': ('成人向け', '胸'),
            'medium chest': ('成人向け', '胸'),
            '胸元': ('成人向け', '胸'),
            'cleavage': ('成人向け', '胸'),
            'セクシーな谷間': ('成人向け', '胸'),
            'sexy cleavage': ('成人向け', '胸'),
            '谷間': ('成人向け', '胸'),
            'breasts shade': ('成人向け', '胸'),
            
            # 尻・下半身関連
            'お尻を掴む': ('成人向け', '尻'),
            'grab your ass': ('成人向け', '尻'),
            'お尻の穴': ('成人向け', '尻'),
            'anal hole': ('成人向け', '尻'),
            'アナル挿入': ('成人向け', '挿入'),
            'anal insertion': ('成人向け', '挿入'),
            'アナルプラグ': ('成人向け', 'アイテム'),
            'anal plug': ('成人向け', 'アイテム'),
            'アナルパール': ('成人向け', 'アイテム'),
            'anal pearls': ('成人向け', 'アイテム'),
            'アナルビーズ': ('成人向け', 'アイテム'),
            'anal beads': ('成人向け', 'アイテム'),
            'anal beas': ('成人向け', 'アイテム'),
            'アナルフック': ('成人向け', 'アイテム'),
            'anal hook': ('成人向け', 'アイテム'),
            '赤いお尻': ('成人向け', '尻'),
            'red butt': ('成人向け', '尻'),
            'buttocks': ('成人向け', '尻'),
            'ass': ('成人向け', '尻'),
            'butt': ('成人向け', '尻'),
            
            # 性的プレイ・体位
            'フェラチオ': ('成人向け', '口淫'),
            'blowjob': ('成人向け', '口淫'),
            'fellatio': ('成人向け', '口淫'),
            'deepthroat': ('成人向け', '口淫'),
            'イマラチオ': ('成人向け', '口淫'),
            'oral': ('成人向け', '口淫'),
            'しゃぶる': ('成人向け', '口淫'),
            '咥える': ('成人向け', '口淫'),
            'hold in mouth': ('成人向け', '口淫'),
            '口内': ('成人向け', '口淫'),
            'in the mouth': ('成人向け', '口淫'),
            '口に': ('成人向け', '口淫'),
            '舐める': ('成人向け', '前戯'),
            'lick': ('成人向け', '前戯'),
            'licking': ('成人向け', '前戯'),
            'なめ': ('成人向け', '前戯'),
            '舌なめずり': ('成人向け', '前戯'),
            'licking one\'s lips': ('成人向け', '前戯'),
            '舌': ('成人向け', '前戯'),
            'tongue': ('成人向け', '前戯'),
            'out tongue': ('成人向け', '前戯'),
            
            # 性器・生殖器関連
            'あそこを広げる': ('成人向け', '性器'),
            'spread that place': ('成人向け', '性器'),
            '割れ目': ('成人向け', '性器'),
            'crack': ('成人向け', '性器'),
            'われめ': ('成人向け', '性器'),
            'were': ('成人向け', '性器'),
            'slit': ('成人向け', '性器'),
            'suji': ('成人向け', '性器'),
            'pussy': ('成人向け', '性器'),
            'vagina': ('成人向け', '性器'),
            'vagia': ('成人向け', '性器'),
            'vagnal': ('成人向け', '性器'),
            '処女膜': ('成人向け', '性器'),
            'hymen': ('成人向け', '性器'),
            '破瓜': ('成人向け', '性器'),
            'breaking the hymen': ('成人向け', '性器'),
            '処女': ('成人向け', '属性'),
            'virgin': ('成人向け', '属性'),
            '頸部': ('成人向け', '性器'),
            'cervix': ('成人向け', '性器'),
            '子宮口': ('成人向け', '性器'),
            '口子宮': ('成人向け', '性器'),
            'クリトリス': ('成人向け', '性器'),
            'clitoris': ('成人向け', '性器'),
            'クリトリス　ピアス': ('成人向け', '装飾'),
            'clitoris piercing': ('成人向け', '装飾'),
            
            # 体液・排泄関連
            '汗が滴る': ('成人向け', '肌'),
            'sweat dripping': ('成人向け', '肌'),
            '汁': ('成人向け', '肌'),
            'juice': ('成人向け', '肌'),
            '粘液': ('成人向け', '肌'),
            'mucus': ('成人向け', '肌'),
            '粘膜': ('成人向け', '肌'),
            'mucous membrane': ('成人向け', '肌'),
            'ぬるぬる': ('成人向け', '肌'),
            'slimy': ('成人向け', '肌'),
            'ヌルヌル': ('成人向け', '肌'),
            '滴る': ('成人向け', '肌'),
            'dripping': ('成人向け', '肌'),
            '唾液ローション': ('成人向け', '肌'),
            'saliva lotion': ('成人向け', '肌'),
            'ローション': ('成人向け', '肌'),
            'lotion': ('成人向け', '肌'),
            'つば': ('成人向け', '肌'),
            'spit': ('成人向け', '肌'),
            'saliva': ('成人向け', '肌'),
            'drool': ('成人向け', '肌'),
            'Drool': ('成人向け', '肌'),
            'saliva_trail': ('成人向け', '肌'),
            '尿': ('成人向け', 'スカトロ'),
            'urine': ('成人向け', 'スカトロ'),
            '小便': ('成人向け', 'スカトロ'),
            'piss': ('成人向け', 'スカトロ'),
            '用を足す': ('成人向け', 'スカトロ'),
            'relieve yourself': ('成人向け', 'スカトロ'),
            '聖水': ('成人向け', 'スカトロ'),
            'holy water': ('成人向け', 'スカトロ'),
            '失禁': ('成人向け', 'スカトロ'),
            'poop': ('成人向け', 'スカトロ'),
            '糞尿': ('成人向け', 'スカトロ'),
            
            # アイテム・おもちゃ
            'バイブ': ('成人向け', 'アイテム'),
            'vibe': ('成人向け', 'アイテム'),
            'Vibe': ('成人向け', 'アイテム'),
            'バイブレーター': ('成人向け', 'アイテム'),
            'vibrator': ('成人向け', 'アイテム'),
            'マシンバイブ': ('成人向け', 'アイテム'),
            'machine vibrator': ('成人向け', 'アイテム'),
            '電マ': ('成人向け', 'アイテム'),
            'オナホ': ('成人向け', 'アイテム'),
            'onahole': ('成人向け', 'アイテム'),
            'sex toys': ('成人向け', 'アイテム'),
            'コックリング': ('成人向け', 'アイテム'),
            'cock ring': ('成人向け', 'アイテム'),
            'ガムテープ': ('成人向け', 'アイテム'),
            'packing tape': ('成人向け', 'アイテム'),
            'クスコ': ('成人向け', 'アイテム'),
            'cusco': ('成人向け', 'アイテム'),
            'バキュム': ('成人向け', 'アイテム'),
            'bakyu-mu': ('成人向け', 'アイテム'),
            'condom': ('成人向け', 'アイテム'),
            
            # 性的状態・表情
            '絶頂': ('成人向け', '絶頂'),
            'climax': ('成人向け', '絶頂'),
            'orgasm': ('成人向け', '絶頂'),
            'イキ': ('成人向け', '絶頂'),
            'iki': ('成人向け', '絶頂'),
            '絶頂y': ('成人向け', '絶頂'),
            'ぜっちょ': ('成人向け', '絶頂'),
            'zecho': ('成人向け', '絶頂'),
            'あへ': ('成人向け', '表情'),
            'アへ': ('成人向け', '表情'),
            'ahe': ('成人向け', '表情'),
            'あえぎ': ('成人向け', '表情'),
            'gasping': ('成人向け', '表情'),
            '恍惚': ('成人向け', '表情'),
            'ecstasy': ('成人向け', '表情'),
            '媚薬': ('成人向け', 'アイテム'),
            'aphrodisiac': ('成人向け', 'アイテム'),
            
            # その他成人向け
            'チンカス': ('成人向け', '性器'),
            'ちんかす': ('成人向け', '性器'),
            'dick cheese': ('成人向け', '性器'),
            'chinkasu': ('成人向け', '性器'),
            '他人が乳首をなめる': ('成人向け', '前戯'),
            'someone else licks my nipples': ('成人向け', '前戯'),
            'ピストン': ('成人向け', '性交'),
            'piston': ('成人向け', '性交'),
            'mating press': ('成人向け', '体位'),
            'まんぐり': ('成人向け', '体位'),
            'piledriver': ('成人向け', '体位'),
            'pile-driver': ('成人向け', '体位'),
            'pile driver': ('成人向け', '体位'),
            '腰ふり': ('成人向け', '体位'),
            'hip shaking': ('成人向け', '体位'),
            '腰を突き出す': ('成人向け', '体位'),
            'push out your hips': ('成人向け', '体位'),
            '腰を掴む': ('成人向け', '体位'),
            'grabbing': ('成人向け', '体位'),
            'sex': ('成人向け', '性交'),
            'sexual': ('成人向け', '性交'),
            'intercourse': ('成人向け', '性交'),
            'penetration': ('成人向け', '挿入'),
            '挿入': ('成人向け', '挿入'),
            'insert': ('成人向け', '挿入'),
            'insertion': ('成人向け', '挿入'),
            'deep_penetration': ('成人向け', '挿入'),
            '深い挿入': ('成人向け', '挿入'),
            'imminent penetration': ('成人向け', '挿入'),
            '差し迫った侵入': ('成人向け', '挿入'),
            'penetrate': ('成人向け', '挿入'),
            '覆われた貫通': ('成人向け', '挿入'),
            'covered penetration': ('成人向け', '挿入'),
            'through wall': ('成人向け', '挿入'),
            
            # 自慰・オナニー関連
            '棒オナニー': ('成人向け', '自慰'),
            'masturbation': ('成人向け', '自慰'),
            'self': ('成人向け', '自慰'),
            'セルフ': ('成人向け', '自慰'),
            
            # 危険・グロテスク
            '死姦': ('成人向け', 'グロテスク'),
            'death rape': ('成人向け', 'グロテスク'),
            'necrophilia': ('成人向け', 'グロテスク'),
            '拉致': ('シチュエーション', 'グロテスク'),
            'abduction': ('シチュエーション', 'グロテスク'),
            'いじめ': ('シチュエーション', 'グロテスク'),
            'bullying': ('シチュエーション', 'グロテスク'),
            '暴力': ('シチュエーション', 'グロテスク'),
            '暴': ('シチュエーション', 'グロテスク'),
            'violence': ('シチュエーション', 'グロテスク'),
            
            # 痴漢・覗き
            '痴漢': ('シチュエーション', 'シチュ'),
            'molester': ('シチュエーション', 'シチュ'),
            '盗撮': ('シチュエーション', 'シチュ'),
            'voyeur': ('シチュエーション', 'シチュ'),
            'こだわり': ('シチュエーション', 'シチュ'),
            '覗き': ('シチュエーション', 'シチュ'),
            'peeping': ('シチュエーション', 'シチュ'),
            'peeking': ('シチュエーション', 'シチュ'),
            'peeking out': ('シチュエーション', 'シチュ'),
            
            # レズ・同性愛
            'レズ': ('成人向け', '属性'),
            'lesbian': ('成人向け', '属性'),
            'yuri': ('成人向け', '属性'),
            
            # その他シチュエーション
            'cheating': ('シチュエーション', 'シチュ'),
            'netorare': ('シチュエーション', 'シチュ'),
            'neto': ('シチュエーション', 'シチュ'),
            'NTR': ('シチュエーション', 'シチュ'),
            '悪堕ち': ('シチュエーション', 'シチュ'),
            'fallen into evil': ('シチュエーション', 'シチュ'),
            '悪落ち': ('シチュエーション', 'シチュ'),
            'falling bad': ('シチュエーション', 'シチュ'),
            '洗脳': ('シチュエーション', 'シチュ'),
            'brainwashing': ('シチュエーション', 'シチュ'),
            
            # 身体測定・医療
            '聴診器': ('オブジェクト', '医療'),
            'stethoscope': ('オブジェクト', '医療'),
            '体格': ('身体', '体型'),
            'physical build': ('身体', '体型'),
            '身長': ('身体', '体型'),
            'height': ('身体', '体型'),
            
            # 場所・環境
            '便器': ('オブジェクト', '日用品'),
            'toilet': ('オブジェクト', '日用品'),
            '便所': ('場所', '屋内'),
            '様式便器': ('オブジェクト', '日用品'),
            '洋式便器': ('オブジェクト', '日用品'),
            'western-style toilet': ('オブジェクト', '日用品'),
            '和式便器': ('オブジェクト', '日用品'),
            'japanese style toilet bowl': ('オブジェクト', '日用品'),
            '大浴場': ('場所', '屋内'),
            'large communal bath': ('場所', '屋内'),
            'お風呂に漬かる': ('シチュエーション', '日常'),
            'soak in the bath': ('シチュエーション', '日常'),
            'お風呂に浸かる': ('シチュエーション', '日常'),
            'take a bath': ('シチュエーション', '日常'),
            'バース': ('場所', '屋内'),
            'bath': ('場所', '屋内'),
            '露天風呂': ('場所', '屋外'),
            'open-air bath': ('場所', '屋外'),
            'シャワールーム': ('場所', '屋内'),
            'shower room': ('場所', '屋内'),
            '地下室': ('場所', '屋内'),
            '石の床': ('オブジェクト', '建造物'),
            'stone floor': ('オブジェクト', '建造物'),
            '鏡張りの床': ('オブジェクト', '建造物'),
            '問題': ('シチュエーション', 'シチュ'),
            'ラブホテル': ('場所', '屋内'),
        }
        
        # 処理済み項目
        processed_items = set()
        
        # 各行をチェックして分類
        for line in wish_lines:
            line = line.strip()
            if not line:
                continue
                
            parts = line.split('\t')
            if len(parts) >= 4:
                大項目_orig = parts[0]
                中項目_orig = parts[1]
                小項目 = parts[2]
                prompt = parts[3]
            elif len(parts) == 3:
                大項目_orig = ""
                中項目_orig = parts[0]
                小項目 = parts[1]
                prompt = parts[2]
            elif len(parts) == 2:
                大項目_orig = ""
                中項目_orig = ""
                小項目 = parts[0]
                prompt = parts[1]
            else:
                continue
            
            # キーワードマッチング
            matched = False
            for keyword, (大項目, 中項目) in adult_situation_keywords.items():
                if keyword in 小項目 or keyword in prompt:
                    stage3_items.append(f"{大項目}\t{中項目}\t{小項目}\t{prompt}")
                    processed_items.add(小項目)
                    matched = True
                    break
            
            if not matched:
                remaining_items.append(line)
        
        print(f"第3段階: {len(stage3_items)}個の項目を抽出しました")
        
        # マスターデータに追加
        if stage3_items:
            with open('マスターデータ.tsv', 'a', encoding='utf-8') as f:
                for item in stage3_items:
                    f.write(item + '\n')
            print(f"マスターデータに{len(stage3_items)}個の項目を追加しました")
        
        # 残り項目を追加希望.tsvに書き戻し
        with open('追加希望.tsv', 'w', encoding='utf-8') as f:
            for item in remaining_items:
                f.write(item + '\n')
        
        print(f"残り項目数: {len(remaining_items)}")
        
    except Exception as e:
        print(f"エラーが発生しました: {e}")

if __name__ == "__main__":
    main()