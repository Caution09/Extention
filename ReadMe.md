# Prompt Generator

画像生成 AI（Stable Diffusion、NovelAI、ComfyUI 等）用のプロンプトを効率的に管理・生成する Chrome 拡張機能です。
📌 プライバシーについて
検索機能で入力されたキーワードは、今後の辞書更新の参考とするため、検索ワードのみを収集する場合があります。
収集する情報：

検索キーワードのみ

収集しない情報：

個人情報
生成したプロンプト
その他のユーザーデータ

技術的な詳細：検索ログの収集は api-client.js の SearchLogAPI で行われ、検索ワード以外の情報は一切取得していません。

## 🌟 主な機能

### 1. プロンプト管理

- **複数プロンプトスロット**: プロンプトを切り替えて管理
- **スロット管理**: 専用タブで一覧表示・編集、Ctrl+1〜9 でクイック切り替え
- **全スロット結合**: Generate ボタンで全スロットを結合して生成
- プロンプトの保存・読み込み
- カテゴリー別の整理（大・中・小カテゴリー）

### 2. 高度な要素抽出機能 ✨

- **通常モード**: 従来のテキスト編集
- **ランダム抽出モード**: カテゴリーから毎回ランダムに 1 要素を選択
- **連続抽出モード**: カテゴリーから順番に 1 要素を選択
- カテゴリーフィルターで抽出範囲を指定
- Generate 時のリアルタイム抽出表示（タイムスタンプ付き）

### 3. 検索・翻訳機能

- キーワード検索とカテゴリーフィルター
- Google 翻訳/DeepL API による自動翻訳
- 検索結果からワンクリックで追加

### 4. 編集機能

- ドラッグ&ドロップで要素の並び替え
- 重み付け編集（SD/NAI/None 形式対応）
- テキスト編集モード/選択編集モード
- サイトに応じた記法の自動切り替え

### 5. 辞書機能

- ローカル要素辞書（カスタム辞書）
- マスター辞書（デフォルト辞書）
- プロンプト辞書（よく使うプロンプトの保存）
- CSV 形式でのインポート/エクスポート

### 6. ビジュアルセレクター機能 🎯

- マウスホバーで要素をハイライト表示
- クリックで自動的に CSS セレクターを取得
- セレクター候補の自動生成とスコアリング
- リアルタイムでセレクターの有効性を検証

### 7. マルチサービス対応 🌐

- **対応サービス**: NovelAI、Stable Diffusion WebUI、ComfyUI 等
- サービスごとのプリセット選択
- URL に応じて自動的にサービスを判定
- 任意の AI 画像生成サービスで使用可能

### 8. 自動化機能

- **自動 Generate**: 指定回数・間隔での連続生成
- **自動保存**: 拡張機能終了時の状態保存
- **連続カンマの自動正規化**: 入力ミスを自動修正

### 9. データ管理

- PNG 画像からのプロンプト情報抽出
- 設定の完全バックアップ/リストア（JSON 形式）
- CSV ファイルのドラッグ&ドロップ対応

### 10. その他の便利機能

- **ショートカットキー**: Alt+G（サイドパネル）、Ctrl+S（保存）、Ctrl+K（検索）等
- **コンテキストメニュー**: 右クリックから素早くアクセス
- **セレクター管理**: 「その他」タブで詳細設定

## 📦 インストール方法

### 初回インストール

1. **リポジトリをダウンロード**

   ```bash
   git clone https://github.com/MilkyPuree/PromptGenerator.git
   ```

   または [Releases](https://github.com/MilkyPuree/PromptGenerator/releases) から最新版の ZIP ファイルをダウンロード

2. **Chrome の拡張機能ページを開く**

   - Chrome のアドレスバーに `chrome://extensions/` を入力
   - または、メニュー → その他のツール → 拡張機能

3. **デベロッパーモードを有効化**

   - 右上の「デベロッパーモード」を ON にする

4. **拡張機能を読み込む**

   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - ダウンロードしたフォルダを選択

5. **インストール完了**
   - ツールバーに拡張機能のアイコンが表示されます
   - ピン留めしておくと便利です

## 🔄 更新方法

### 方法 1: Git を使用（推奨）

```bash
# プロジェクトフォルダに移動
cd PromptGenerator

# 最新版を取得
git pull origin main

# Chrome拡張機能ページで「更新」ボタンをクリック
```

### 方法 2: 手動更新

1. [Releases](https://github.com/MilkyPuree/PromptGenerator/releases) から最新版をダウンロード
2. 既存のフォルダに上書き（設定は `chrome.storage` に保存されているので消えません）
3. Chrome 拡張機能ページで「更新」ボタンをクリック

## 🚀 使い方

### 基本的な使い方

1. **拡張機能アイコンをクリック**してポップアップを開く（または Alt+G でサイドパネル）

2. **検索タブ**

   - キーワードを入力して検索
   - カテゴリーで絞り込み
   - 「Set」で現在のプロンプトに追加、「Copy」でクリップボードにコピー

3. **辞書タブ**

   - プロンプトを「Save」ボタンで保存
   - 要素を追加して独自の辞書を作成
   - CSV エクスポート/インポート対応

4. **編集タブ**

   - 現在のプロンプトの要素を個別に編集
   - 重み付けを調整（SD/NAI/None 形式）
   - ドラッグ&ドロップで順序変更

5. **スロットタブ**

   - 10 個のプロンプトスロットを管理
   - 各スロットに名前を付けて整理
   - 要素抽出モードの設定（通常/ランダム/連続）

6. **その他タブ**
   - セレクター設定（ビジュアルセレクター）
   - DeepL API キー設定
   - 設定のバックアップ/リストア

### ショートカットキー

**ポップアップ内**

- **Ctrl+S**: 現在のプロンプトを辞書に保存
- **Ctrl+C**: プロンプトをコピー
- **Ctrl+K**: 検索ボックスにフォーカス
- **Ctrl+1〜9**: プロンプトスロット切り替え
- **Tab**: タブ間の移動

**グローバル**

- **Alt+G**: サイドパネルを開く
- **Ctrl+Shift+S**: 選択テキストを辞書に保存

### 高度な使い方

#### 要素抽出モード

1. スロットタブで任意のスロットを選択
2. モードを「ランダム」または「連続」に設定
3. カテゴリーフィルターで抽出範囲を指定
4. Generate 時に自動的に要素が選択されます

#### ビジュアルセレクター

1. 「その他」タブを開く
2. サービスプリセットを選択（または手動設定）
3. 「👁」ボタンをクリックして選択モード開始
4. ページ上の要素をクリックしてセレクターを取得
5. 「保存」ボタンで設定を保存

#### 自動 Generate

1. 「その他」タブで「自動 Generate」にチェック
2. 生成回数と間隔を設定（0 = 無限）
3. Generate ボタンを押すと自動実行開始

## 📁 フォルダ構成

```
PromptGenerator/
├── manifest.json          # 拡張機能の設定
├── popup.html            # メインUI（すべてのスクリプトの読み込み順序を定義）
├── popup.css             # スタイル
├── README.md             # このファイル
│
├── js/
│   ├── background.js     # バックグラウンド処理（コンテキストメニュー管理）
│   ├── main.js          # メインアプリケーション（全体の統括、約1000行）
│   ├── content.js          # メインアプリケーション（全体の統括、約1000行）
│   │
│   ├── core/            # コア機能
│   │   ├── storage.js         # Chrome Storage APIラッパー
│   │   ├── app-state.js       # グローバル状態管理（全モジュールから参照）
│   │   ├── error-handler.js   # エラー処理・通知
│   │   └── validators.js      # 入力検証
│   │
│   ├── data/            # データ管理
│   │   ├── data-manager.js    # データ永続化（storage.jsを使用）
│   │   ├── category-manager.js # カテゴリー管理（app-stateと連携）
│   │   ├── prompt-editor.js   # プロンプト編集エンジン（main.jsから呼び出し）
│   │   └── prompt-slots.js    # 複数スロット管理（app-stateと同期）
│   │
│   ├── ui/              # UI関連
│   │   ├── components/        # UI部品
│   │   │   ├── ui-factory.js      # UI要素生成（各タブから使用）
│   │   │   ├── ui-utilities.js    # UIユーティリティ（全UI系で共通利用）
│   │   │   └── list-manager.js    # リスト表示管理（各タブから使用）
│   │   │
│   │   └── tabs/              # タブ別モジュール
│   │       ├── tab-manager.js     # タブ基底クラス（他のタブが継承）
│   │       ├── search-tab.js      # 検索タブ（search-handlerを内包）
│   │       ├── dictionary-tab.js  # 辞書タブ（dictionary-handlerを内包）
│   │       ├── edit-tab.js        # 編集タブ（edit-handlerを内包）
│   │       ├── slot-tab.js        # スロットタブ（prompt-slotsと密接に連携）
│   │       └── other-tab.js       # その他タブ（設定・インポート機能）
│   │
│   ├── features/        # 個別機能
│   │   ├── file-handler.js        # ファイル処理（各種インポート機能）
│   │   ├── csv-handler.js         # CSV入出力（file-handlerから呼び出し）
│   │   ├── auto-generate-handler.js # 自動生成（NovelAI連携）
│   │   ├── shortcut-manager.js    # ショートカット（main.jsで初期化）
│   │   ├── settings-manager.js    # 設定管理（app-stateと同期）
│   │   ├── search-handler.js      # 検索処理（search-tabから使用）
│   │   ├── edit-handler.js        # 編集処理（edit-tabから使用）
│   │   └── dictionary-handler.js  # 辞書処理（dictionary-tabから使用）
│   │
│   └── external/        # 外部連携
│       ├── api-client.js          # API通信（翻訳・外部サービス）
│       └── global-utilities.js    # 後方互換用（レガシー関数群）
│
├── lib/                 # 外部ライブラリ
│   ├── jquery-3.5.1.js
│   ├── jquery-ui.js
│   └── papaparse.min.js
│
└── assets/
    ├── icon/           # アイコンファイル
    └── master/         # マスターデータ（デフォルト辞書）
```

## 🔧 トラブルシューティング

### 拡張機能が表示されない

1. `chrome://extensions/` で有効になっているか確認
2. エラーが表示されている場合は「エラー」をクリックして詳細を確認

### データが消えた

- データは Chrome の同期ストレージに保存されています
- Chrome にログインしていることを確認
- 開発者ツール → Application → Storage → Local Storage で確認

### 翻訳が動作しない

1. インターネット接続を確認
2. DeepL API を使用する場合は、その他タブ → DeepL API キーを設定

### セレクターが機能しない

1. ページを再読み込み
2. 「その他」タブでセレクターを再設定
3. プリセットから選択、またはビジュアルセレクターで取得

## 📝 更新履歴

### v2.1.0 (2024-12-XX)

- ✨ ビジュアルセレクター機能
- ✨ マルチサービス対応
- ✨ 要素抽出モード（ランダム/連続）
- ✨ Generate 時のリアルタイム表示
- 🐛 各種バグ修正

### v2.0.0 (2024-11-XX)

- ✨ 複数プロンプトスロット管理
- ✨ CSV 入出力機能
- ✨ 自動 Generate 機能
- ✨ 設定のインポート/エクスポート
- ♻️ 大規模リファクタリング（jQuery 削除、モジュール化）

## 🎯 今後の予定

- プロンプト履歴機能
- スロットグループ機能
- テーマ切り替え（ダークモード）
- プロンプト分析機能

詳細は [Prompt Generator アップデート計画書.md](./Prompt%20Generator%20アップデート計画書.md) を参照してください。

## 📄 ライセンス

[MIT ライセンス](LICENSE)

## 🤝 貢献

バグ報告や機能提案は [Issues](https://github.com/MilkyPuree/PromptGenerator/issues) へ

## 📧 連絡先

- GitHub: [@MilkyPuree](https://github.com/MilkyPuree)
- X(Twitter): [@milky_puree](https://twitter.com/milky_puree)

---

⭐ このプロジェクトが役に立ったら、スターをお願いします！
